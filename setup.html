<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Setup</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
        }
        .message { 
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
            max-width: 500px;
            text-align: center;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .info {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #b8daff;
        }
        .message a {
            color: inherit;
            text-decoration: underline;
        }
        .message h2 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div id="message" class="message info">
        Setting up admin account...
    </div>

    <script type="module">
        import { auth, db } from "./firebase-config.js";
        import { createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const ADMIN_EMAIL = "admin@quizplatform.com";
        const ADMIN_PASSWORD = "Admin@123456";
        const ADMIN_NAME = "System Administrator";

        async function setupAdminUser() {
            const messageDiv = document.getElementById("message");
            try {
                // First check if admin user exists in Auth
                try {
                    const userCredential = await signInWithEmailAndPassword(auth, ADMIN_EMAIL, ADMIN_PASSWORD);
                    const user = userCredential.user;
                    
                    // Check if Firestore document exists
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if (!userDoc.exists()) {
                        // Create admin document in Firestore if it doesn't exist
                        await setDoc(doc(db, "users", user.uid), {
                            name: ADMIN_NAME,
                            email: ADMIN_EMAIL,
                            role: "admin",
                            status: "active",
                            createdAt: new Date()
                        });
                    }
                    
                    messageDiv.className = "message success";
                    messageDiv.innerHTML = `
                        <h2>✅ Admin Account Ready</h2>
                        <p>The admin account is already set up and ready to use.</p>
                        <p><a href="login.html">Go to Login Page</a></p>
                    `;
                    return;
                } catch (authError) {
                    // If sign in fails, create new admin account
                    const userCredential = await createUserWithEmailAndPassword(auth, ADMIN_EMAIL, ADMIN_PASSWORD);
                    const user = userCredential.user;

                    await setDoc(doc(db, "users", user.uid), {
                        name: ADMIN_NAME,
                        email: ADMIN_EMAIL,
                        role: "admin",
                        status: "active",
                        createdAt: new Date()
                    });

                    messageDiv.className = "message success";
                    messageDiv.innerHTML = `
                        <h2>✅ Admin Account Created Successfully!</h2>
                        <p><strong>Email:</strong> ${ADMIN_EMAIL}</p>
                        <p><strong>Password:</strong> ${ADMIN_PASSWORD}</p>
                        <p>Please change your password after first login.</p>
                        <p><a href="login.html">Go to Login Page</a></p>
                    `;
                }
            } catch (error) {
                console.error("Setup error:", error);
                messageDiv.className = "message error";
                if (error.code === "auth/email-already-in-use") {
                    messageDiv.innerHTML = `
                        <h2>❌ Admin Account Setup Issue</h2>
                        <p>There was a problem with the admin account setup. Please try logging in.</p>
                        <p><a href="login.html">Go to Login Page</a></p>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <h2>❌ Error Creating Admin Account</h2>
                        <p>${error.message}</p>
                        <p>Please try again later or contact support.</p>
                    `;
                }
            }
        }

        // Run the setup when the page loads
        setupAdminUser();
    </script>
</body>
</html>